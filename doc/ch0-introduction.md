# 并发基本概念及实现，进程、线程基本概念
[toc]

## 并发、进程、线程的基本概念和综述
**并发、线程和进程要求必须掌握**
### 并发
`多个任务同时发生`，`并发`是`并行`的子集，`并行`是`并发`的超集。并发是指两个或多个事件在同一时间间隔内发生，而并行则是指两个或多个事件在同一时刻发生。
1. 以往计算机，单核 cpu （中央处理器）实现并发的方式：某一时刻只能执行一个任务，由操作系统调度，每秒钟进行多次所谓的“任务切换”。
并发的假象（不是真正的并发）；这种切换（上下文切换）是要有时间开销的，比如操作系统需要保存切换时的各种状态，执行进度等信息，都需要时间，一会切换回来的时候，还要恢复这些信息，这些时间开销就是上下文切换的时间开销。
2. 随着硬件的发展，出现了多处理计算机：用于服务器和高性能计算领域。在一块芯片上有多核 cpu,能够实现真正的冰心执行多个任务（硬件并发）。

使用并发的原因：**提高性能**。

### 可执行程序
磁盘上的一个文件，在Windows下是.exe文件，在Linux下是.bin文件，这个文件是可执行的，可以被操作系统加载到内存中，然后由操作系统执行。这个文件就是可执行程序。

### 进程
进程就是一个可程序程序运行起来的实例，是一个具体的运行中的程序，是一个动态的概念。进程是操作系统进行资源分配和调度的一个独立单位。

### 线程
1. 每个进程都有一个主线程，这个主线程是唯一的。
2. 当执行一个程序，产生一个进程后，主线程就随着进程一起创建了。
3. 主线程是程序运行的入口，主线程结束，进程就结束了。
4. 主线程可以创建多个子线程，子线程是主线程的一部分，主线程结束，子线程也会结束。
5. 每创建一个子线程，就会产生一个线程对象，这个线程对象就是一个线程。
6. 线程并不是越多越好，每个线程都需要一个对立的堆栈空间（1M左右），如果线程太多，会导致内存不足。线程之间的切换需要保存很多中间状态，这个也需要时间，如果线程太多，会导致切换时间过长，从而影响性能。

### 总结
1. 进程是操作系统进行资源分配和调度的一个独立单位。
2. 线程是进程的一个实体，是CPU调度和分派的基本单位。
3. 一个进程自动包含一个主线程，主线程可以创建多个子线程。


## 并发的实现方法
1. 多进程
2. 在单独的进程中，创建多个线程实现并发。手动编写除了主线程之外的其他线程。

### 多进程并发
Word 启动后就是进程，ie浏览器启动也是一个进程，QQ启动也是一个进程，这些进程都是并发的，都是同时运行的。
在游戏开发过程中，存在账号服务器，游戏服务器，数据库服务器，这些服务器都是并发的，都是同时运行的。需要解决的问题是：如何让这些服务器之间进行通信。
同一电脑上的多个进程之间通信：管道，消息队列，共享内存，信号量，套接字等。
不同电脑上的多个进程之间通信：套接字。

### 多线程并发
统一进程中的所有线程共享进程的资源，比如：内存（全局变量、指针、引用），文件句柄，信号量等。
共享内存带来新的问题：数据一致性如何保证？多个线程同时操作一个数据，会导致数据不一致，比如：一个线程在读取数据，另一个线程在写入数据，这时候数据就不一致了。解决方法：加锁，互斥锁，读写锁，信号量等。
和进程相比，线程的创建和销毁的开销要小很多，线程之间的切换也要快很多，所以线程是并发的首选。

多进程并发和多线程并发虽然可以同时使用，但应当优先考虑吧多线程技术手段而不是多进程。


## `C++11` 新标准线程库
以往，在不同平台下需要调用不同的接口创建线程：
- Windows： `CreateThread()`, `_beginthreadex()`, `_beginthreadexe()`
- Linux: `pthread_create()`
- Mac: `pthread_create()`
不能跨平台。
从 `C++11` 开始，`C++` 标准库提供了跨平台的线程库，可以在不同平台下使用相同的接口创建线程，意味着可以跨平台。